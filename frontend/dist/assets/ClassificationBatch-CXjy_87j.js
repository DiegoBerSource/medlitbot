import{k as pe,X as xe,r as y,e as D,a as ye,l as i,J as l,A as e,z as m,Z as P,$ as ge,m as g,F,G as E,C as r,q as V,B as C,L as b,E as U,_ as X,p as be,u as j}from"./vendor-CqXe5Vco.js";import{b as _e,_ as f,a as he}from"./index-D07s5EKd.js";import{u as we}from"./models-BXZoxh5i.js";import{u as Ce}from"./classification-BFQJskH4.js";import"./utils-DWA4hw-v.js";import"./charts-DqDWejEF.js";const ke={class:"p-6 max-w-6xl mx-auto"},Ae={class:"medical-card mb-8"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},$e=["value"],Me={key:0,class:"mt-1 text-sm text-red-600"},Te={key:0,class:"p-4 bg-gradient-from-blue-50 to-gray-50 rounded-lg border border-blue-200"},Fe={class:"flex items-center justify-between mb-3"},Ee={class:"font-semibold text-gray-900 flex items-center"},Ne={key:1,class:"ml-2 px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full"},Be={class:"text-xs text-gray-500"},De={class:"grid grid-cols-2 gap-4 mb-3"},Ve={class:"space-y-2"},je={class:"flex justify-between text-sm"},Re={class:"flex justify-between text-sm"},Le={class:"space-y-2"},Ie={class:"flex justify-between text-sm"},Pe={class:"flex justify-between text-sm"},Ue={class:"pt-3 border-t border-gray-200"},Oe={class:"grid grid-cols-2 gap-4 text-xs text-gray-600"},Je={class:"ml-1"},qe={class:"ml-1"},ze={class:"ml-1"},He={class:"ml-1"},Xe={class:"medical-card mb-8"},Ge={class:"flex space-x-4 mb-6"},Ye={key:0,class:"space-y-4"},Ze={key:0},Ke={key:1,class:"text-left max-w-md mx-auto"},Qe={class:"flex items-start space-x-3"},We={class:"flex-1"},et={class:"font-medium text-gray-900"},tt={key:0,class:"text-sm text-green-600 mt-1"},st={key:1,class:"space-y-4"},at={class:"flex justify-between items-center"},lt={class:"space-y-6"},rt={class:"flex justify-between items-start mb-4"},ot={class:"font-medium text-gray-900"},it=["onClick"],nt={class:"space-y-4"},ct=["for"],dt=["id","onUpdate:modelValue"],ut=["for"],mt=["id","onUpdate:modelValue"],ft={key:0,class:"text-center py-8 text-gray-500"},vt={class:"flex items-center justify-between"},pt={class:"flex space-x-4"},xt=["disabled"],yt=["disabled"],gt={key:0,class:"mt-8"},bt={class:"medical-card"},_t={class:"medical-card-header"},ht={class:"flex items-center justify-between"},wt={class:"text-sm text-gray-600"},Ct={class:"text-sm text-gray-500"},kt={class:"space-y-4"},At={class:"flex items-start justify-between mb-3"},St={class:"font-medium text-gray-900 text-sm"},$t={class:"text-xs text-gray-500 ml-4"},Mt={key:0,class:"mb-3"},Tt={class:"flex flex-wrap gap-2"},Ft={key:1,class:"mb-2"},Et={class:"grid grid-cols-2 md:grid-cols-3 gap-2"},Nt={class:"text-gray-700 truncate mr-2"},Bt={class:"flex items-center space-x-1"},Dt={class:"w-10 bg-gray-200 rounded-full h-1"},Vt={class:"font-mono text-gray-900 text-xs w-8 text-right"},jt={key:2,class:"text-center py-4"},Rt={key:1,class:"mt-8"},Lt={class:"bg-red-50 border border-red-200 rounded-lg p-4"},It={class:"flex items-center"},Pt={class:"text-red-700 mt-1 text-sm"},Ut=pe({__name:"ClassificationBatch",setup(Ot){const v=_e(),G=xe(),O=we(),A=Ce(),S=y(!1),R=y(!1),u=y(""),w=y("file"),T=y(!1),_=y(null),$=y(),p=y([]),k=y([]),x=y(null),N=D(()=>O.models.filter(s=>s.status==="trained"||s.is_trained)),h=D(()=>{if(N.value.length===0)return null;const s=t=>t.f1_score?{primary:t.f1_score,secondary:t.accuracy||0}:t.accuracy?{primary:t.accuracy,secondary:0}:{primary:0,secondary:0};return N.value.slice().sort((t,a)=>{const o=s(t),c=s(a);return o.primary!==c.primary?c.primary-o.primary:o.secondary!==c.secondary?c.secondary-o.secondary:new Date(a.updated_at).getTime()-new Date(t.updated_at).getTime()})[0]}),n=D(()=>N.value.find(s=>s.id===Number(u.value))||null),L=D(()=>{const s=u.value&&u.value!=="",t=J()>0;return s&&t}),J=()=>{switch(w.value){case"file":return p.value.length;case"manual":return k.value.filter(s=>s.title.trim()&&s.abstract.trim()).length;default:return 0}},Y=()=>{switch(w.value){case"file":return p.value;case"manual":return k.value.filter(s=>s.title.trim()&&s.abstract.trim());default:return[]}},Z=()=>{$.value?.click()},K=s=>{const t=s.target;t.files&&t.files[0]&&(_.value=t.files[0],q(t.files[0]))},Q=s=>{T.value=!1,s.dataTransfer?.files&&s.dataTransfer.files[0]&&(_.value=s.dataTransfer.files[0],q(s.dataTransfer.files[0]))},q=async s=>{try{console.log("Parsing file:",s.name,"size:",s.size);const t=await s.text(),a=s.name.split(".").pop()?.toLowerCase();if(a==="csv")p.value=W(t);else if(a==="json")p.value=ee(t);else{v.error("Unsupported file format. Please use CSV or JSON.");return}console.log("Parsed articles:",p.value.length);const o=1e3;p.value.length>o?v.warning(`⚠️ Large file detected: ${p.value.length} articles found. The system can only process up to ${o} articles at once. You may need to split this file into smaller batches.`):v.success(`Parsed ${p.value.length} articles from file`)}catch(t){console.error("Error parsing file:",t),v.error("Error parsing file. Please check the format."),p.value=[]}},W=s=>{const t=s.split(`
`).filter(d=>d.trim());if(t.length<2)throw new Error("CSV file must have at least a header row and one data row");const a=t[0]?.split(",").map(d=>d.trim().replace(/"/g,""))||[];console.log("CSV headers found:",a);const o=a.findIndex(d=>d.toLowerCase().includes("title")||d.toLowerCase()==="title"||d.toLowerCase()==="name"),c=a.findIndex(d=>d.toLowerCase().includes("abstract")||d.toLowerCase().includes("summary")||d.toLowerCase().includes("description"));if(console.log("Title index:",o,"Abstract index:",c),o===-1||c===-1)throw new Error(`CSV must contain title and abstract columns. Found headers: ${a.join(", ")}`);const M=t.slice(1).map((d,fe)=>{const H=d.split(",").map(ve=>ve.trim().replace(/"/g,"")),I={title:H[o]||"",abstract:H[c]||""};return console.log(`Article ${fe+1}:`,I.title.substring(0,50),"...",I.abstract.substring(0,50)),I}).filter(d=>d.title.trim()&&d.abstract.trim());return console.log("Valid articles parsed:",M.length),M},ee=s=>{const t=JSON.parse(s);if(!Array.isArray(t))throw new Error("JSON must be an array of articles");return t.map(a=>({title:a.title||a.Title||"",abstract:a.abstract||a.Abstract||a.summary||""})).filter(a=>a.title&&a.abstract)},te=()=>{k.value.push({title:"",abstract:""})},se=s=>{k.value.splice(s,1)},ae=()=>{_.value=null,p.value=[],$.value&&($.value.value="")},le=()=>{},re=async()=>{if(!u.value||u.value===""){R.value=!0,v.error("Please select a model for classification");return}const s=Y();if(s.length===0){v.error("Please add articles to classify");return}const t=1e3;if(s.length>t){v.error(`Too many articles: Maximum ${t} articles allowed, but you have ${s.length}. Please reduce the number of articles or split into smaller batches.`);return}S.value=!0,x.value=null;try{const a=await A.batchClassify(Number(u.value),{articles:s});x.value=a,v.success(`Successfully classified ${s.length} articles!`),setTimeout(()=>{const o=document.querySelector(".medical-card:last-of-type");o&&o.scrollIntoView({behavior:"smooth",block:"start"})},100)}catch(a){console.error("Batch classification error:",a);const o=a.message||A.error||"Error during batch classification. Please try again.";v.error(o)}finally{S.value=!1}},oe=()=>{_.value=null,p.value=[],k.value=[],x.value=null,$.value&&($.value.value=""),v.info("All data cleared")},ie=()=>{x.value=null,v.info("Results cleared")},ne=()=>{G.push("/classification/history")},z=s=>s.charAt(0).toUpperCase()+s.slice(1).replace(/_/g," "),ce=s=>({biobert:"BioBERT",clinicalbert:"ClinicalBERT",scibert:"SciBERT",pubmedbert:"PubMedBERT",bert:"BERT",hybrid:"Hybrid Ensemble",traditional:"Traditional ML"})[s]||s.charAt(0).toUpperCase()+s.slice(1),B=s=>s?s>=.8?"text-green-600":s>=.7?"text-blue-600":s>=.6?"text-yellow-600":"text-red-600":"text-gray-500",de=s=>s?s<60?`${s.toFixed(0)}m`:s<1440?`${(s/60).toFixed(1)}h`:`${(s/1440).toFixed(1)}d`:"N/A",ue=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),me=s=>Object.entries(s).sort(([,t],[,a])=>a-t).slice(0,6);return ye(async()=>{try{await O.fetchModels(),h.value&&!u.value&&(u.value=String(h.value.id),v.success(`Best model "${h.value.name}" selected automatically`,{timeout:3e3}))}catch(s){console.error("Failed to load models:",s),v.error("Failed to load models")}}),(s,t)=>(l(),i("div",ke,[t[32]||(t[32]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Batch Classification"),e("p",{class:"mt-2 text-gray-600"},"Classify multiple medical literature articles at once")],-1)),e("div",Ae,[t[16]||(t[16]=e("div",{class:"medical-card-header"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Select Classification Model"),e("p",{class:"text-sm text-gray-600"},"Choose a trained model for batch processing")],-1)),e("div",Se,[e("div",null,[t[7]||(t[7]=e("label",{for:"model",class:"block text-sm font-medium text-gray-700 mb-2"}," Trained Model * ",-1)),P(e("select",{id:"model","onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),required:"",class:g(["input-field",{"border-red-500":!u.value&&R.value}]),onChange:le},[t[6]||(t[6]=e("option",{value:""},"Select a trained model",-1)),(l(!0),i(F,null,E(N.value,a=>(l(),i("option",{key:a.id,value:a.id},r(a.name)+r(h.value&&a.id===h.value.id?" ⭐ (Best)":"")+" - "+r(a.f1_score?`F1: ${(a.f1_score*100).toFixed(1)}%`:a.accuracy?`Acc: ${(a.accuracy*100).toFixed(1)}%`:"Training"),9,$e))),128))],34),[[ge,u.value]]),!u.value&&R.value?(l(),i("p",Me," Please select a model for classification ")):m("",!0)]),n.value?(l(),i("div",Te,[e("div",Fe,[e("h3",Ee,[h.value&&n.value.id===h.value.id?(l(),V(f,{key:0,name:"check-circle",class:"w-4 h-4 text-green-500 mr-2"})):m("",!0),C(" "+r(n.value.name)+" ",1),h.value&&n.value.id===h.value.id?(l(),i("span",Ne,"Best")):m("",!0)]),e("div",Be,r(ce(n.value.model_type)),1)]),e("div",De,[e("div",Ve,[e("div",je,[t[8]||(t[8]=e("span",{class:"text-gray-600"},"F1 Score:",-1)),e("span",{class:g(["font-medium",B(n.value.f1_score)])},r(n.value.f1_score?`${(n.value.f1_score*100).toFixed(1)}%`:"N/A"),3)]),e("div",Re,[t[9]||(t[9]=e("span",{class:"text-gray-600"},"Accuracy:",-1)),e("span",{class:g(["font-medium",B(n.value.accuracy)])},r(n.value.accuracy?`${(n.value.accuracy*100).toFixed(1)}%`:"N/A"),3)])]),e("div",Le,[e("div",Ie,[t[10]||(t[10]=e("span",{class:"text-gray-600"},"Precision:",-1)),e("span",{class:g(["font-medium",B(n.value.precision)])},r(n.value.precision?`${(n.value.precision*100).toFixed(1)}%`:"N/A"),3)]),e("div",Pe,[t[11]||(t[11]=e("span",{class:"text-gray-600"},"Recall:",-1)),e("span",{class:g(["font-medium",B(n.value.recall)])},r(n.value.recall?`${(n.value.recall*100).toFixed(1)}%`:"N/A"),3)])])]),e("div",Ue,[e("div",Oe,[e("div",null,[t[12]||(t[12]=e("span",{class:"font-medium"},"Dataset:",-1)),e("span",Je,r(n.value.dataset_name||`Dataset ${n.value.dataset}`),1)]),e("div",null,[t[13]||(t[13]=e("span",{class:"font-medium"},"Training Time:",-1)),e("span",qe,r(de(n.value.training_time_minutes)),1)]),e("div",null,[t[14]||(t[14]=e("span",{class:"font-medium"},"Epochs:",-1)),e("span",ze,r(n.value.best_epoch||n.value.num_epochs||"N/A"),1)]),e("div",null,[t[15]||(t[15]=e("span",{class:"font-medium"},"Created:",-1)),e("span",He,r(ue(n.value.created_at)),1)])])])])):m("",!0)])]),e("div",Xe,[t[25]||(t[25]=e("div",{class:"medical-card-header"},[e("h2",{class:"text-xl font-semibold text-gray-900"},"Input Articles"),e("p",{class:"text-sm text-gray-600"},"Choose how to provide articles for classification")],-1)),e("div",Ge,[e("button",{onClick:t[1]||(t[1]=a=>w.value="file"),class:g(["method-btn",{"method-btn-active":w.value==="file"}])},[b(f,{name:"document",class:"w-5 h-5 mr-2"}),t[17]||(t[17]=C(" Upload File ",-1))],2),e("button",{onClick:t[2]||(t[2]=a=>w.value="manual"),class:g(["method-btn",{"method-btn-active":w.value==="manual"}])},[b(f,{name:"edit",class:"w-5 h-5 mr-2"}),t[18]||(t[18]=C(" Manual Entry ",-1))],2)]),w.value==="file"?(l(),i("div",Ye,[e("div",{onDragover:t[3]||(t[3]=U(a=>T.value=!0,["prevent"])),onDragleave:t[4]||(t[4]=U(a=>T.value=!1,["prevent"])),onDrop:U(Q,["prevent"]),class:g(["border-2 border-dashed rounded-lg p-8 text-center transition-colors",{"border-blue-400 bg-blue-50":T.value,"border-gray-300":!T.value&&!_.value,"border-green-400 bg-green-50":_.value}])},[b(f,{name:_.value?"document":"plus",class:"w-12 h-12 mx-auto text-gray-400 mb-4"},null,8,["name"]),_.value?(l(),i("div",Ke,[e("div",Qe,[b(f,{name:"document",class:"w-6 h-6 text-green-600 mt-1"}),e("div",We,[e("p",et,r(_.value.name),1),p.value.length?(l(),i("p",tt,r(p.value.length)+" articles found ",1)):m("",!0),e("div",{class:"mt-2"},[e("button",{onClick:ae,class:"text-sm text-red-600 hover:text-red-700"}," Remove ")])])])])):(l(),i("div",Ze,[t[20]||(t[20]=e("p",{class:"text-lg font-medium text-gray-900 mb-2"}," Drop your article file here ",-1)),t[21]||(t[21]=e("p",{class:"text-gray-600 mb-4"},"CSV or JSON file with title and abstract columns",-1)),e("button",{type:"button",onClick:Z,class:"btn-primary"},[b(f,{name:"plus",class:"w-4 h-4 mr-2"}),t[19]||(t[19]=C(" Choose File ",-1))]),e("input",{ref_key:"fileInputRef",ref:$,type:"file",accept:".csv,.json",class:"hidden",onChange:K},null,544)]))],34)])):m("",!0),w.value==="manual"?(l(),i("div",st,[e("div",at,[t[23]||(t[23]=e("h4",{class:"text-lg font-medium text-gray-900"},"Articles",-1)),e("button",{onClick:te,class:"btn-outline"},[b(f,{name:"plus",class:"w-4 h-4 mr-2"}),t[22]||(t[22]=C(" Add Article ",-1))])]),e("div",lt,[(l(!0),i(F,null,E(k.value,(a,o)=>(l(),i("div",{key:o,class:"p-4 border border-gray-200 rounded-lg"},[e("div",rt,[e("h5",ot,"Article "+r(o+1),1),e("button",{onClick:c=>se(o),class:"text-red-600 hover:text-red-700"},[b(f,{name:"delete",class:"w-4 h-4"})],8,it)]),e("div",nt,[e("div",null,[e("label",{for:`title-${o}`,class:"block text-sm font-medium text-gray-700 mb-2"}," Title * ",8,ct),P(e("input",{id:`title-${o}`,"onUpdate:modelValue":c=>a.title=c,type:"text",required:"",class:"input-field",placeholder:"Enter article title..."},null,8,dt),[[X,a.title]])]),e("div",null,[e("label",{for:`abstract-${o}`,class:"block text-sm font-medium text-gray-700 mb-2"}," Abstract * ",8,ut),P(e("textarea",{id:`abstract-${o}`,"onUpdate:modelValue":c=>a.abstract=c,rows:"4",required:"",class:"input-field",placeholder:"Enter article abstract..."},null,8,mt),[[X,a.abstract]])])])]))),128))]),k.value.length===0?(l(),i("div",ft,[b(f,{name:"document",class:"w-12 h-12 mx-auto mb-4 text-gray-300"}),t[24]||(t[24]=e("p",null,'No articles added yet. Click "Add Article" to get started.',-1))])):m("",!0)])):m("",!0)]),e("div",vt,[e("div",{class:g(["text-sm",L.value?"text-green-600":"text-gray-500"])},[L.value?(l(),V(f,{key:0,name:"check-circle",class:"w-4 h-4 inline mr-1 text-green-500"})):m("",!0),C(" "+r(J())+" articles ready for classification "+r(u.value&&u.value!==""?`• Model: ${n.value?.name||"Selected"}`:""),1)],2),e("div",pt,[e("button",{onClick:oe,class:"btn-secondary",disabled:S.value}," Clear All ",8,xt),e("button",{onClick:re,class:"btn-primary",disabled:!L.value||S.value},[S.value?(l(),V(f,{key:0,name:"clock",class:"w-4 h-4 mr-2 animate-spin"})):(l(),V(f,{key:1,name:"brain",class:"w-4 h-4 mr-2"})),C(" "+r(S.value?"Classifying...":"Classify Articles"),1)],8,yt)])]),x.value&&x.value.results&&x.value.results.length>0?(l(),i("div",gt,[e("div",bt,[e("div",_t,[e("div",ht,[e("div",null,[t[26]||(t[26]=e("h2",{class:"text-xl font-semibold text-gray-900"},"Classification Results",-1)),e("p",wt," Successfully classified "+r(x.value.total_processed||x.value.results.length)+" articles in "+r((x.value.processing_time_seconds*1e3||x.value.total_inference_time_ms).toFixed(0))+"ms ",1)]),e("div",Ct,[t[27]||(t[27]=e("span",{class:"font-medium"},"Model:",-1)),C(" "+r(x.value.model_used||"Unknown"),1)])])]),e("div",kt,[(l(!0),i(F,null,E(x.value.results,(a,o)=>(l(),i("div",{key:o,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},[e("div",At,[e("h3",St,r(a.title||`Article ${a.article_index}`),1),e("div",$t,r(a.inference_time_ms?a.inference_time_ms.toFixed(1)+"ms":"N/A"),1)]),a.predicted_domains&&a.predicted_domains.length>0?(l(),i("div",Mt,[t[28]||(t[28]=e("h4",{class:"text-xs font-medium text-gray-700 mb-2"},"Predicted Medical Domains",-1)),e("div",Tt,[(l(!0),i(F,null,E(a.predicted_domains,c=>(l(),i("span",{key:c,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},r(z(c)),1))),128))])])):m("",!0),a.confidence_scores&&Object.keys(a.confidence_scores).length>0?(l(),i("div",Ft,[t[29]||(t[29]=e("h4",{class:"text-xs font-medium text-gray-700 mb-2"},"Confidence Scores",-1)),e("div",Et,[(l(!0),i(F,null,E(me(a.confidence_scores),([c,M])=>(l(),i("div",{key:c,class:"flex items-center justify-between text-xs bg-white rounded px-2 py-1"},[e("span",Nt,r(z(c)),1),e("div",Bt,[e("div",Dt,[e("div",{class:g(["h-1 rounded-full",M>=(a.prediction_threshold||.5)?"bg-green-500":"bg-gray-400"]),style:be(`width: ${M*100}%`)},null,6)]),e("span",Vt,r((M*100).toFixed(0))+"%",1)])]))),128))])])):m("",!0),!a.predicted_domains||a.predicted_domains.length===0?(l(),i("div",jt,[b(f,{name:"alert-circle",class:"w-5 h-5 text-yellow-500 mx-auto mb-2"}),t[30]||(t[30]=e("p",{class:"text-sm text-gray-600"},"No domains predicted for this article",-1))])):m("",!0)]))),128))]),e("div",{class:"mt-6 pt-4 border-t border-gray-200 flex justify-between items-center"},[e("button",{onClick:ie,class:"btn-secondary text-sm"}," Clear Results "),e("button",{onClick:ne,class:"btn-outline text-sm"}," View Full History → ")])])])):m("",!0),j(A).error?(l(),i("div",Rt,[e("div",Lt,[e("div",It,[b(f,{name:"alert-circle",class:"w-5 h-5 text-red-600 mr-2"}),t[31]||(t[31]=e("h3",{class:"text-red-800 font-medium"},"Classification Error",-1))]),e("p",Pt,r(j(A).error),1),e("button",{onClick:t[5]||(t[5]=(...a)=>j(A).clearError&&j(A).clearError(...a)),class:"mt-3 text-red-600 hover:text-red-800 text-sm underline"}," Dismiss ")])])):m("",!0)]))}}),Yt=he(Ut,[["__scopeId","data-v-71374a70"]]);export{Yt as default};
//# sourceMappingURL=ClassificationBatch-CXjy_87j.js.map
