import{O as S,r as l,e as d}from"./vendor-CqXe5Vco.js";import{e as h}from"./index-D07s5EKd.js";const M=S("classification",()=>{const o=l([]),u=l(null),a=l(!1),f=l(!1),c=l(null),m=d(()=>o.value.length),_=d(()=>{const r={};return o.value.forEach(t=>{t.predicted_domains?.forEach(e=>{r[e]||(r[e]=[]),r[e].push(t)})}),r}),v=d(()=>o.value.slice().sort((r,t)=>new Date(t.created_at).getTime()-new Date(r.created_at).getTime()).slice(0,10)),p=d(()=>({total:m.value,domains:Object.keys(_.value).length,recentCount:v.value.length})),g=async(r=1,t=20)=>{a.value=!0,c.value=null;try{const e=await h.getPredictions(r,t);return r===1?o.value=e.items||e.results||[]:o.value.push(...e.items||e.results||[]),e}catch(e){throw c.value=e instanceof Error?e.message:"Failed to fetch predictions",console.error("Failed to fetch predictions:",e),e}finally{a.value=!1}},y=async r=>{a.value=!0,c.value=null;try{const t=o.value.find(e=>e.id===r);if(t)return u.value=t,t;throw new Error("Prediction not found")}catch(t){throw c.value=t instanceof Error?t.message:"Failed to fetch prediction",console.error("Failed to fetch prediction:",t),t}finally{a.value=!1}},w=async(r,t)=>{a.value=!0,c.value=null;try{const e={...t,model_id:r},s=await h.predict(r,e),n={id:Date.now(),model:r,title:t.title,abstract:t.abstract,predicted_domains:s.predicted_domains,confidence_scores:s.confidence_scores,all_domain_scores:s.all_domain_scores||s.confidence_scores,prediction_threshold:t.threshold||.5,inference_time_ms:s.inference_time_ms||0,created_at:new Date().toISOString()};return o.value.unshift(n),u.value=n,s}catch(e){throw c.value=e instanceof Error?e.message:"Failed to classify article",console.error("Failed to classify article:",e),e}finally{a.value=!1}},b=async(r,t)=>{f.value=!0,c.value=null;try{const e=await h.batchPredict(r,t),s=e.results.map((n,i)=>({id:Date.now()+i,model:r,title:t.articles?.[i]?.title||"",abstract:t.articles?.[i]?.abstract||"",predicted_domains:n.predicted_domains,confidence_scores:n.confidence_scores,all_domain_scores:n.confidence_scores,prediction_threshold:t.threshold||.5,inference_time_ms:n.inference_time_ms||0,created_at:new Date().toISOString()}));return o.value.unshift(...s),e}catch(e){const s=F(e);throw c.value=s,console.error("Failed to perform batch classification:",e),new Error(s)}finally{f.value=!1}},E=()=>{o.value=[]},P=()=>{c.value=null},D=()=>{u.value=null},F=r=>{const t="Failed to perform batch classification",e=r.response?.data?.detail;if(!e)return r.response?.data?.error||r.message||t;if(typeof e=="string")return e;if(Array.isArray(e)&&e.length>0){const s=e[0];if(s.type==="too_long"&&s.loc?.includes("articles")){const n=s.ctx?.max_length||1e3,i=s.ctx?.actual_length||"unknown";return`Too many articles: Maximum ${n} articles allowed, but you provided ${i}`}return s.msg||t}return t};return{predictions:o,currentPrediction:u,loading:a,batchLoading:f,error:c,totalPredictions:m,predictionsByDomain:_,recentPredictions:v,predictionStats:p,fetchPredictions:g,fetchPrediction:y,classify:w,batchClassify:b,clearPredictions:E,clearError:P,clearCurrentPrediction:D}});export{M as u};
//# sourceMappingURL=classification-BFQJskH4.js.map
