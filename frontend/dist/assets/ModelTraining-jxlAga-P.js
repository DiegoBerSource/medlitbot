import{b as K,_ as v,a as X}from"./index-D07s5EKd.js";import{u as Y}from"./models-BXZoxh5i.js";import{u as W}from"./training-DiT7B9Ie.js";import{O as Z,r as p,k as j,e as tt,w as et,a as st,Q as at,l,J as i,A as t,z as h,C as r,L as x,B as M,m as F,p as L,F as rt,G as nt}from"./vendor-CqXe5Vco.js";import"./utils-DWA4hw-v.js";import"./charts-DqDWejEF.js";const ot=Z("websocket",()=>{const w=p(!1),d=p(null),g=p(0),E=5,b=W(),S=u=>{if(d.value?.readyState===WebSocket.OPEN)return;const c=window.location.protocol==="https:"?"wss:":"ws:",m=u?`${c}//${window.location.host}/ws/training/${u}/`:`${c}//${window.location.host}/ws/training/`;d.value=new WebSocket(m),d.value.onopen=()=>{w.value=!0,g.value=0,console.log("WebSocket connected")},d.value.onmessage=y=>{const f=JSON.parse(y.data);a(f)},d.value.onclose=()=>{w.value=!1,console.log("WebSocket disconnected"),g.value<E&&setTimeout(()=>{g.value++,S(u)},1e3*Math.pow(2,g.value))},d.value.onerror=y=>{console.error("WebSocket error:",y)}},o=()=>{d.value&&(d.value.close(),d.value=null,w.value=!1,g.value=0)},a=u=>{if(u.type==="training_progress"){const c=u.data;b.updateJobProgress(c.model_id,{progress_percentage:c.progress_percentage,current_epoch:c.current_epoch,total_epochs:c.total_epochs,current_loss:c.current_loss,current_accuracy:c.current_accuracy,status:c.status,updated_at:c.timestamp})}};return{connected:w,connect:S,disconnect:o,reconnectAttempts:g}}),lt={class:"p-6 max-w-7xl mx-auto"},it={class:"mb-8"},dt={class:"flex items-center justify-between mb-4"},ct={key:0,class:"text-gray-600 mt-1"},ut={class:"flex space-x-3"},mt=["disabled"],gt=["disabled"],pt=["disabled"],vt={key:0,class:"flex items-center justify-center py-12"},xt={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 mb-6"},yt={class:"flex items-center"},ft={class:"mt-1 text-sm text-red-700"},_t={key:2,class:"space-y-6"},ht={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},bt={class:"lg:col-span-2"},wt={key:0,class:"medical-card"},Tt={class:"flex items-center justify-between mb-6"},kt={class:"mb-6"},St={class:"flex justify-between text-sm text-gray-600 mb-2"},Mt={class:"progress-bar"},Ct={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},Dt={class:"text-center"},Ft={class:"text-2xl font-bold text-gray-900"},Et={class:"text-center"},$t={class:"text-2xl font-bold text-gray-900"},At={class:"text-center"},Rt={class:"text-2xl font-bold text-gray-900"},Bt={class:"text-center"},Pt={class:"text-2xl font-bold text-gray-900"},Jt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},Nt={class:"ml-1 font-medium"},Ht={key:0},Lt={class:"ml-1 font-medium"},Wt={key:1},zt={class:"ml-1 font-medium"},Ut={key:2},Ot={class:"ml-1 font-medium"},Vt={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md"},It={class:"flex items-start"},Gt={class:"mt-1 text-sm text-red-700"},Qt={key:1,class:"medical-card text-center py-12"},qt=["disabled"],Kt={class:"space-y-6"},Xt={key:0,class:"medical-card"},Yt={class:"space-y-3 text-sm"},Zt={class:"flex justify-between"},jt={class:"font-medium"},te={class:"flex justify-between"},ee={class:"flex justify-between"},se={class:"font-medium"},ae={class:"flex justify-between"},re={class:"font-medium"},ne={key:0,class:"flex justify-between"},oe={class:"font-medium text-green-600"},le={class:"medical-card"},ie={class:"space-y-3"},de={class:"flex justify-between text-sm"},ce={class:"font-medium"},ue={class:"flex justify-between text-sm"},me={class:"font-medium text-green-600"},ge={class:"flex justify-between text-sm"},pe={class:"font-medium text-red-600"},ve={key:0,class:"medical-card"},xe={class:"flex items-center justify-between mb-6"},ye=["disabled"],fe={class:"overflow-x-auto"},_e={class:"min-w-full divide-y divide-gray-200"},he={class:"bg-white divide-y divide-gray-200"},be={class:"px-6 py-4 whitespace-nowrap"},we={class:"px-6 py-4 whitespace-nowrap"},Te={class:"flex items-center"},ke={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},Se={class:"text-sm text-gray-900"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ee={key:1,class:"medical-card text-center py-12"},$e=j({__name:"ModelTraining",props:{id:{}},setup(w){const d=w,g=K(),E=Y(),b=W(),S=ot(),o=p(null),a=p(null),u=p([]),c=p(!0),m=p(!1),y=p(null),f=p(null),P=tt(()=>a.value?.status==="running");et(P,s=>{s?A():R()}),st(async()=>{await z(),S.connect(d.id),P.value&&A()}),at(()=>{R(),S.disconnect()});const z=async()=>{c.value=!0,y.value=null;try{await Promise.all([U(),J(),$()])}catch(s){y.value=s instanceof Error?s.message:"Failed to load training data",console.error("Failed to load data:",s)}finally{c.value=!1}},U=async()=>{try{o.value=await E.fetchModel(d.id)}catch(s){throw console.error("Failed to load model:",s),new Error("Failed to load model details")}},J=async()=>{try{a.value=await b.fetchJob(d.id)}catch(s){a.value=null,console.log("No active training job found:",s instanceof Error?s.message:s)}},$=async()=>{try{await b.fetchJobs(),u.value=b.jobs.filter(s=>s.model===d.id).sort((s,e)=>new Date(e.started_at||0).getTime()-new Date(s.started_at||0).getTime())}catch(s){console.error("Failed to load training history:",s),u.value=[]}},C=async()=>{m.value=!0;try{await Promise.all([J(),$()])}catch(s){console.error("Failed to refresh training data:",s),g.error("Failed to refresh training data")}finally{m.value=!1}},A=()=>{f.value&&clearInterval(f.value),f.value=setInterval(async()=>{await C()},5e3)},R=()=>{f.value&&(clearInterval(f.value),f.value=null)},N=async()=>{if(o.value){m.value=!0;try{const s={total_epochs:o.value.parameters?.hyperparameters?.epochs||3,batch_size:o.value.parameters?.hyperparameters?.batch_size||16,learning_rate:parseFloat(o.value.parameters?.hyperparameters?.learning_rate||"2e-5"),validation_split:o.value.parameters?.validation_split||.2},e=await b.startTraining(d.id,s);a.value=e,g.success("Training started successfully!"),A()}catch(s){console.error("Failed to start training:",s),g.error("Failed to start training. Please try again.")}finally{m.value=!1}}},O=async()=>{m.value=!0;try{await b.stopJob(d.id),g.success("Training stopped successfully!"),await C(),R()}catch(s){console.error("Failed to stop training:",s),g.error("Failed to stop training. Please try again.")}finally{m.value=!1}},B=s=>({pending:"Pending",running:"Running",completed:"Completed",failed:"Failed",created:"Created",training:"Training"})[s]||s.charAt(0).toUpperCase()+s.slice(1),V=s=>({bert:"BERT",biobert:"BioBERT",clinicalbert:"ClinicalBERT",scibert:"SciBERT",traditional:"Traditional ML",hybrid:"Hybrid",custom:"Custom"})[s]||s.toUpperCase(),I=s=>({created:"text-gray-600",training:"text-blue-600",completed:"text-green-600",failed:"text-red-600"})[s]||"text-gray-600",D=s=>{if(!s)return"--";try{return new Date(s).toLocaleString()}catch{return"--"}},G=()=>{if(!a.value?.started_at)return"--";const s=new Date(a.value.started_at),n=new Date().getTime()-s.getTime(),T=Math.floor(n/(1e3*60*60)),_=Math.floor(n%(1e3*60*60)/(1e3*60));return T>0?`${T}h ${_}m`:`${_}m`},Q=s=>{if(!s.started_at)return"--";const e=new Date(s.started_at),T=(s.completed_at?new Date(s.completed_at):new Date).getTime()-e.getTime(),_=Math.floor(T/(1e3*60*60)),k=Math.floor(T%(1e3*60*60)/(1e3*60));return _>0?`${_}h ${k}m`:`${k}m`},q=()=>{if(!a.value?.started_at||!a.value.progress_percentage)return"--";const s=new Date(a.value.started_at),n=new Date().getTime()-s.getTime();if(a.value.progress_percentage>0){const _=n/a.value.progress_percentage*100-n;if(_>0){const k=Math.floor(_/6e4),H=Math.floor(k/60);return H>0?`~${H}h ${k%60}m`:`~${k}m`}}return"--"};return(s,e)=>(i(),l("div",lt,[t("div",it,[t("div",dt,[t("div",null,[e[0]||(e[0]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Model Training",-1)),o.value?(i(),l("p",ct,r(o.value.name),1)):h("",!0)]),t("div",ut,[!a.value||a.value.status!=="running"?(i(),l("button",{key:0,onClick:N,disabled:m.value||!o.value||o.value.status==="training",class:"btn-primary"},[x(v,{name:"play",class:"w-4 h-4 mr-2"}),e[1]||(e[1]=M(" Start Training ",-1))],8,mt)):h("",!0),a.value&&a.value.status==="running"?(i(),l("button",{key:1,onClick:O,disabled:m.value,class:"btn-secondary"},[x(v,{name:"stop",class:"w-4 h-4 mr-2"}),e[2]||(e[2]=M(" Stop Training ",-1))],8,gt)):h("",!0),t("button",{onClick:C,disabled:m.value,class:"btn-outline"},[x(v,{name:"refresh",class:"w-4 h-4 mr-2"}),e[3]||(e[3]=M(" Refresh ",-1))],8,pt)])])]),c.value?(i(),l("div",vt,[...e[4]||(e[4]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),t("p",{class:"mt-2 text-gray-600"},"Loading training data...")],-1)])])):y.value?(i(),l("div",xt,[t("div",yt,[x(v,{name:"alert",class:"w-5 h-5 text-red-500 mr-2"}),e[5]||(e[5]=t("h3",{class:"text-sm font-medium text-red-800"},"Error",-1))]),t("p",ft,r(y.value),1),t("button",{onClick:C,class:"mt-3 btn-outline text-red-700 border-red-300 hover:bg-red-50"}," Try Again ")])):(i(),l("div",_t,[t("div",ht,[t("div",bt,[a.value?(i(),l("div",wt,[t("div",Tt,[e[6]||(e[6]=t("h3",{class:"text-xl font-semibold text-gray-900"},"Training Progress",-1)),t("span",{class:F(["status-badge text-sm",{"status-badge-success":a.value.status==="completed","status-badge-warning":a.value.status==="running","status-badge-error":a.value.status==="failed","status-badge-info":a.value.status==="pending"}])},r(B(a.value.status)),3)]),t("div",kt,[t("div",St,[e[7]||(e[7]=t("span",null,"Overall Progress",-1)),t("span",null,r(Math.round(a.value.progress_percentage))+"%",1)]),t("div",Mt,[t("div",{class:F(["progress-bar-fill transition-all duration-300",{"bg-green-500":a.value.status==="completed","bg-blue-500":a.value.status==="running","bg-red-500":a.value.status==="failed"}]),style:L({width:a.value.progress_percentage+"%"})},null,6)])]),t("div",Ct,[t("div",Dt,[t("div",Ft,r(a.value.current_epoch),1),e[8]||(e[8]=t("div",{class:"text-sm text-gray-500"},"Current Epoch",-1))]),t("div",Et,[t("div",$t,r(a.value.total_epochs),1),e[9]||(e[9]=t("div",{class:"text-sm text-gray-500"},"Total Epochs",-1))]),t("div",At,[t("div",Rt,r(a.value.current_loss?a.value.current_loss.toFixed(4):"--"),1),e[10]||(e[10]=t("div",{class:"text-sm text-gray-500"},"Current Loss",-1))]),t("div",Bt,[t("div",Pt,r(a.value.current_accuracy?(a.value.current_accuracy*100).toFixed(1)+"%":"--"),1),e[11]||(e[11]=t("div",{class:"text-sm text-gray-500"},"Current Accuracy",-1))])]),t("div",Jt,[t("div",null,[e[12]||(e[12]=t("span",{class:"text-gray-500"},"Started:",-1)),t("span",Nt,r(D(a.value.started_at)),1)]),a.value.completed_at?(i(),l("div",Ht,[e[13]||(e[13]=t("span",{class:"text-gray-500"},"Completed:",-1)),t("span",Lt,r(D(a.value.completed_at)),1)])):a.value.status==="running"?(i(),l("div",Wt,[e[14]||(e[14]=t("span",{class:"text-gray-500"},"Estimated:",-1)),t("span",zt,r(q()),1)])):h("",!0),a.value.started_at&&a.value.status==="running"?(i(),l("div",Ut,[e[15]||(e[15]=t("span",{class:"text-gray-500"},"Duration:",-1)),t("span",Ot,r(G()),1)])):h("",!0)]),a.value.error_message?(i(),l("div",Vt,[t("div",It,[x(v,{name:"alert",class:"w-4 h-4 text-red-500 mt-0.5 mr-2 flex-shrink-0"}),t("div",null,[e[16]||(e[16]=t("h4",{class:"text-sm font-medium text-red-800"},"Training Error",-1)),t("p",Gt,r(a.value.error_message),1)])])])):h("",!0)])):(i(),l("div",Qt,[x(v,{name:"brain",class:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e[18]||(e[18]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Active Training",-1)),e[19]||(e[19]=t("p",{class:"text-gray-600 mb-6"},"This model is not currently being trained. Start training to monitor progress here.",-1)),t("button",{onClick:N,disabled:m.value||!o.value,class:"btn-primary"},[x(v,{name:"play",class:"w-4 h-4 mr-2"}),e[17]||(e[17]=M(" Start Training ",-1))],8,qt)]))]),t("div",Kt,[o.value?(i(),l("div",Xt,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Model Details",-1)),t("div",Yt,[t("div",Zt,[e[20]||(e[20]=t("span",{class:"text-gray-500"},"Type:",-1)),t("span",jt,r(V(o.value.model_type)),1)]),t("div",te,[e[21]||(e[21]=t("span",{class:"text-gray-500"},"Status:",-1)),t("span",{class:F(["font-medium",I(o.value.status)])},r(B(o.value.status)),3)]),t("div",ee,[e[22]||(e[22]=t("span",{class:"text-gray-500"},"Dataset:",-1)),t("span",se,r(o.value.dataset_name||"Unknown"),1)]),t("div",ae,[e[23]||(e[23]=t("span",{class:"text-gray-500"},"Created:",-1)),t("span",re,r(D(o.value.created_at)),1)]),o.value.accuracy?(i(),l("div",ne,[e[24]||(e[24]=t("span",{class:"text-gray-500"},"Best Accuracy:",-1)),t("span",oe,r((o.value.accuracy*100).toFixed(1))+"%",1)])):h("",!0)])])):h("",!0),t("div",le,[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Training History",-1)),t("div",ie,[t("div",de,[e[26]||(e[26]=t("span",{class:"text-gray-500"},"Total Runs:",-1)),t("span",ce,r(u.value.length),1)]),t("div",ue,[e[27]||(e[27]=t("span",{class:"text-gray-500"},"Successful:",-1)),t("span",me,r(u.value.filter(n=>n.status==="completed").length),1)]),t("div",ge,[e[28]||(e[28]=t("span",{class:"text-gray-500"},"Failed:",-1)),t("span",pe,r(u.value.filter(n=>n.status==="failed").length),1)])])])])]),u.value.length>0?(i(),l("div",ve,[t("div",xe,[e[31]||(e[31]=t("h3",{class:"text-xl font-semibold text-gray-900"},"Training History",-1)),t("button",{onClick:$,disabled:m.value,class:"btn-outline text-sm"},[x(v,{name:"refresh",class:"w-4 h-4 mr-1"}),e[30]||(e[30]=M(" Refresh ",-1))],8,ye)]),t("div",fe,[t("table",_e,[e[32]||(e[32]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Progress"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Epochs"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Best Accuracy"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Duration"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Started")])],-1)),t("tbody",he,[(i(!0),l(rt,null,nt(u.value.slice(0,10),n=>(i(),l("tr",{key:n.id,class:"hover:bg-gray-50"},[t("td",be,[t("span",{class:F(["status-badge text-xs",{"status-badge-success":n.status==="completed","status-badge-warning":n.status==="running","status-badge-error":n.status==="failed","status-badge-info":n.status==="pending"}])},r(B(n.status)),3)]),t("td",we,[t("div",Te,[t("div",ke,[t("div",{class:"bg-blue-600 h-2 rounded-full",style:L({width:n.progress_percentage+"%"})},null,4)]),t("span",Se,r(Math.round(n.progress_percentage))+"%",1)])]),t("td",Me,r(n.current_epoch)+"/"+r(n.total_epochs),1),t("td",Ce,r(n.current_accuracy?(n.current_accuracy*100).toFixed(1)+"%":"--"),1),t("td",De,r(Q(n)),1),t("td",Fe,r(D(n.started_at)),1)]))),128))])])])])):(i(),l("div",Ee,[x(v,{name:"chart",class:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Training History",-1)),e[34]||(e[34]=t("p",{class:"text-gray-600"},"Training history will appear here once you start training this model.",-1))]))]))]))}}),He=X($e,[["__scopeId","data-v-6fb427ba"]]);export{He as default};
//# sourceMappingURL=ModelTraining-jxlAga-P.js.map
